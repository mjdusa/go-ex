---
name: linter - run full battery of linters

on:
  workflow_dispatch:

  workflow_call:

  push:

  pull_request:

env:
  target_ref: ${{ github.head_ref || github.ref_name }}
  GO111MODULE: on
  GOPRIVATE: ''

jobs:
  linter:
    strategy:
      matrix:
        os: [ubuntu-latest]

    runs-on: ${{ matrix.os }}

    steps:
      - name: actions/checkout
        uses: actions/checkout@3df4ab11eba7bda6032a0b82a6bb43b11571feac #v4.0.0
        with:
          repository: ${{ github.repository }}
          ref: ${{ env.target_ref }}
          token: ${{ github.token }}
          # Full git history is needed to get a proper list of changed files
          # within `super-linter`.
          fetch-depth: 0

      - name: super-linter/super-linter
        uses: super-linter/super-linter@v5
        env:
          DEFAULT_BRANCH: main
          GITHUB_TOKEN: ${{ github.token }}
          LOG_LEVEL: VERBOSE
          VALIDATE_ALL_CODEBASE: true
          VALIDATE_EDITORCONFIG: false
          VALIDATE_GITHUB_ACTIONS: false
          VALIDATE_GO: false # SuperLinter runs linter on one file at a time and
          # reports FALSE errors we will run go linter in a separate step.

      - name: golangci-lint
        uses: golangci/golangci-lint-action@v3
        with:
          # Require: The version of golangci-lint to use.
          # When `install-mode` is `binary` (default) the value can be v1.2 or
          # v1.2.3 or `latest` to use the latest version.
          # When `install-mode` is `goinstall` the value can be v1.2.3,
          # `latest`, or the hash of a commit.
          version: latest

          # Optional: working directory, useful for monorepos
          # working-directory: somedir

          # Optional: golangci-lint command line arguments.
          #
          # Note: By default, the `.golangci.yml` file should be at the root of
          # the repository.  The location of the configuration file can be
          # changed by using `--config=`
          args: --timeout=10m \
                --config .github/linters/.golangci.yml \
                --issues-exit-code 0 \
                --out-format=checkstyle

          # Optional: show only new issues if it's a pull request.
          # The default value is `false`.
          # only-new-issues: true

          # Optional: if set to true, then all caching functionality will be
          #           completely disabled, takes precedence over all other
          #           caching options.
          # skip-cache: true

          # Optional: if set to true, then the action won't cache or restore
          #           ~/go/pkg.
          # skip-pkg-cache: true

          # Optional: if set to true, then the action won't cache or restore
          #           ~/.cache/go-build.
          # skip-build-cache: true

          # Optional: The mode to install golangci-lint. It can be 'binary' or
          # 'goinstall'.
          # install-mode: "goinstall"
